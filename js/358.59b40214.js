(self.webpackChunkvue3_antd_admin=self.webpackChunkvue3_antd_admin||[]).push([[358],{44870:function(e,t,n){"use strict";n.a(e,(async function(e){var r=n(66252),a=n(2262),u=n(83529),o=n(7732),i=n(94124),c=n(76478),l=n(80715),s=n(77655),d=n(13287),f=n(28747),h=e([u,c,i,o,l]);[u,c,i,o,l]=h.then?await h:h;const p=(0,r.Uk)(" 新增 ");t.Z=(0,r.aZ)({name:"SystemPermissionRole",setup(e){const t=(0,a.iH)(),[n]=(0,l.U)(),h=(e,t,n=[])=>t.reduce(((t,r)=>(r.children?.length?h(e,r.children,n):e.includes(r.value)&&t.push(r.value),t)),n),m=async e=>{const[r]=await n({modalProps:{title:(e.id?"编辑":"新增")+"角色",width:"50%",onFinish:async n=>{e.id&&(n.roleId=e.id);const a=r.value?.compRefs?.menus,o=r.value?.compRefs?.depts,i={...n,menus:[...a.halfCheckedKeys,...a.checkedKeys],depts:[...o.halfCheckedKeys,...o.checkedKeys]};await(e.id?u.ul:u.fA)(i),t.value?.refreshTable()}},formSchema:{labelWidth:100,layout:"vertical",schemas:d.y}}),[a,c]=await Promise.all([(0,o.U4)(),(0,i.Af)()]),l=(0,f.bl)(c),s=(0,f.fl)(a);if(r.value?.updateSchema([{field:"menus",componentProps:{treeData:l}},{field:"depts",componentProps:{treeData:s}}]),e.id){const t=await(0,u.Xt)({roleId:e.id}),n=t.menus.map((e=>e.menuId)),a=t.depts.map((e=>e.departmentId));r.value?.setFieldsValue({...e,name:t.roleInfo.name,label:t.roleInfo.label,remark:t.roleInfo.remark,menus:h(n,l),depts:h(a,s)})}},g=[...s.f,{title:"操作",width:160,dataIndex:"$action",hideInSearch:!0,align:"center",fixed:"right",actions:({record:e})=>[{label:"编辑",auth:{perm:"sys.role.update",effect:"disable"},onClick:()=>m(e)},{label:"删除",auth:"sys.role.delete",popConfirm:{title:"你确定要删除吗？",onConfirm:()=>(async e=>{await(0,u.Rd)({roleIds:[e.id]}),t.value?.refreshTable()})(e)}}]}];return(e,n)=>{const o=(0,r.up)("a-button");return(0,r.wg)(),(0,r.iD)("div",null,[(0,r.Wm)((0,a.SU)(c.t),{ref_key:"dynamicTableRef",ref:t,"row-key":"id","header-title":"角色管理","data-request":(0,a.SU)(u.$s),columns:g,bordered:"",size:"small"},{toolbar:(0,r.w5)((()=>[(0,r.Wm)(o,{type:"primary",disabled:!e.$auth("sys.role.add"),onClick:n[0]||(n[0]=e=>m({}))},{default:(0,r.w5)((()=>[p])),_:1},8,["disabled"])])),_:1},8,["data-request"])])}}})}))},7732:function(e,t,n){"use strict";n.a(e,(async function(e){n.d(t,{U4:function(){return o},aS:function(){return i},MB:function(){return c},UJ:function(){return l},m3:function(){return s}});var r=n(30803),a=n(16576),u=e([r]);function o(){return(0,r.W)({url:a.default.list,method:"get"})}function i(e){return(0,r.W)({url:"sys/dept/delete",method:"post",data:e},{successMsg:"删除成功"})}function c(e){return(0,r.W)({url:a.default.update,method:"post",data:e})}function l(e){return(0,r.W)({url:a.default.add,method:"post",data:e})}function s(e){return(0,r.W)({url:a.default.transfer,method:"post",data:e})}r=(u.then?await u:u)[0]}))},94124:function(e,t,n){"use strict";n.a(e,(async function(e){n.d(t,{Af:function(){return o},ZT:function(){return i},_8:function(){return c},RD:function(){return l}});var r=n(30803),a=n(88573),u=e([r]);function o(){return(0,r.W)({url:a.default.list,method:"get"})}function i(e){return(0,r.W)({url:a.default.add,method:"post",data:e},{successMsg:"创建成功"})}function c(e){return(0,r.W)({url:a.default.update,method:"post",data:e},{successMsg:"更新成功"})}function l(e){return(0,r.W)({url:a.default.delete,method:"post",data:e},{successMsg:"删除成功"})}r=(u.then?await u:u)[0]}))},83529:function(e,t,n){"use strict";n.a(e,(async function(e){n.d(t,{Xt:function(){return o},JV:function(){return i},$s:function(){return c},fA:function(){return l},ul:function(){return s},Rd:function(){return d}});var r=n(30803),a=n(2874),u=e([r]);function o(e){return(0,r.W)({url:a.default.info,method:"get",params:e})}function i(e){return(0,r.W)({url:a.default.list,method:"get",data:e})}function c(e){return(0,r.W)({url:a.default.page,method:"get",params:e})}function l(e){return(0,r.W)({url:a.default.add,method:"post",data:e},{successMsg:"创建角色成功"})}function s(e){return(0,r.W)({url:a.default.update,method:"post",data:e},{successMsg:"更新角色成功"})}function d(e){return(0,r.W)({url:a.default.delete,method:"post",data:e},{successMsg:"删除角色成功"})}r=(u.then?await u:u)[0]}))},28747:function(e,t,n){"use strict";n.d(t,{fl:function(){return r},bl:function(){return a},BQ:function(){return u}});const r=(e,t=null,n=[])=>e.filter((e=>e.parentId===t)).map((a=>{const u=n.concat(t||[]),o=r(e,a.id,u);return Object.assign(a,{keyPath:u,title:a.name,key:a.id,value:a.id,formData:a,children:o.length?o:null})})),a=(e,t=null,n=[])=>e.filter((e=>e.parentId===t)).map((r=>{const u=n.concat(t||[]),o=a(e,r.id,u);return Object.assign(r,{keyPath:u,title:r.name,key:r.id,value:r.id,formData:r,children:o.length?o:null})})),u=(e,t=[],n="id",r="children")=>t.reduce(((t,a)=>a[n]===e?a:t||(a[r]?.length?u(e,a[r],n,r):void 0)),void 0)},91030:function(e,t,n){"use strict";n.d(t,{n:function(){return u}});var r=n(66252),a=n(2262);function u(e,t){return{initSortable:function(){(0,r.Y3)((async()=>{if(!e)return;(await n.e(474).then(n.bind(n,51474))).default.create((0,a.SU)(e),{animation:500,delay:400,delayOnTouchOnly:!0,...t})}))}}}},13287:function(e,t,n){"use strict";n.d(t,{y:function(){return r}});const r=[{field:"name",component:"Input",label:"名称",rules:[{required:!0,type:"string"}],colProps:{span:12}},{field:"label",component:"Input",label:"标识",rules:[{required:!0,type:"string"}],colProps:{span:12}},{field:"remark",component:"InputTextArea",label:"备注"},{field:"menus",component:"Tree",label:"菜单权限",colProps:{span:12},componentProps:{checkable:!0,vModelKey:"checkedKeys",style:{height:"350px",paddingTop:"5px",overflow:"auto",borderRadius:"6px",border:"1px solid #dcdfe6"}}},{field:"depts",component:"Tree",label:"部门权限",colProps:{span:12},componentProps:{checkable:!0,vModelKey:"checkedKeys",style:{height:"350px",paddingTop:"5px",overflow:"auto",borderRadius:"6px",border:"1px solid #dcdfe6"}}}]},77655:function(e,t,n){"use strict";n.d(t,{f:function(){return r}});const r=[{title:"#",dataIndex:"id",width:55,align:"center",hideInSearch:!0},{title:"名称",width:200,align:"center",dataIndex:"name"},{title:"标识",width:80,align:"center",dataIndex:"label"},{title:"备注",dataIndex:"remark",align:"center"},{title:"创建时间",dataIndex:"createdAt",align:"center",hideInSearch:!0},{title:"更新时间",align:"center",dataIndex:"updatedAt",hideInSearch:!0}]},1847:function(e,t,n){"use strict";n.a(e,(async function(e){n.r(t);var r=n(7462),a=e([r]);const u=(r=(a.then?await a:a)[0]).Z;t.default=u}))},12316:function(e,t,n){"use strict";n.d(t,{C:function(){return l}});n(48675),n(3462);var r=n(93162),a=n(7869),u=n.n(a);function o(e,t){for(var n,r={},a={s:{c:1e7,r:1e7},e:{c:0,r:0}},o=0;o!=e.length;++o)for(var i=0;i!=e[o].length;++i){a.s.r>o&&(a.s.r=o),a.s.c>i&&(a.s.c=i),a.e.r<o&&(a.e.r=o),a.e.c<i&&(a.e.c=i);var c={v:e[o][i]};if(null!=c.v){var l=u().utils.encode_cell({c:i,r:o});"number"==typeof c.v?c.t="n":"boolean"==typeof c.v?c.t="b":c.v instanceof Date?(c.t="n",c.z=u().SSF._table[14],c.v=(n=c.v,void 0&&(n+=1462),(Date.parse(n)-new Date(Date.UTC(1899,11,30)))/864e5)):c.t="s",r[l]=c}}return a.s.c<1e7&&(r["!ref"]=u().utils.encode_range(a)),r}function i(){if(!(this instanceof i))return new i;this.SheetNames=[],this.Sheets={}}function c(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),r=0;r!=e.length;++r)n[r]=255&e.charCodeAt(r);return t}function l({multiHeader:e=[],header:t,data:n,filename:a,merges:l=[],autoWidth:s=!0,bookType:d="xlsx"}={}){a=a||"excel-list",(n=[...n]).unshift(t);for(let t=e.length-1;t>-1;t--)n.unshift(e[t]);var f="SheetJS",h=new i,p=o(n);if(l.length>0&&(p["!merges"]||(p["!merges"]=[]),l.forEach((e=>{p["!merges"].push(u().utils.decode_range(e))}))),s){const e=n.map((e=>e.map((e=>null==e?{wch:10}:e.toString().charCodeAt(0)>255?{wch:2*e.toString().length}:{wch:e.toString().length}))));let t=e[0];for(let n=1;n<e.length;n++)for(let r=0;r<e[n].length;r++)t[r].wch<e[n][r].wch&&(t[r].wch=e[n][r].wch);p["!cols"]=t}h.SheetNames.push(f),h.Sheets.SheetJS=p;var m=u().write(h,{bookType:d,bookSST:!1,type:"binary"});(0,r.saveAs)(new Blob([c(m)],{type:"application/octet-stream"}),`${a}.${d}`)}},7462:function(e,t,n){"use strict";n.a(e,(async function(e){n.d(t,{Z:function(){return r.Z}});var r=n(44870),a=e([r]);r=(a.then?await a:a)[0]}))},55382:function(){},72095:function(){},61219:function(){}}]);